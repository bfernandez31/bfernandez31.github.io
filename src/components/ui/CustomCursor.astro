---
/**
 * CustomCursor Component
 * Feature: 009-title-custom-cursor
 *
 * A custom circular cursor that replaces the system cursor.
 * - Follows mouse position with smooth GSAP animation
 * - Uses mix-blend-mode: difference for contrast
 * - Scales up on hover over interactive elements (data-cursor="hover")
 * - Respects prefers-reduced-motion preference
 */

interface Props {
	class?: string;
}

const { class: className = "" } = Astro.props;
---

<!-- Canvas for cursor trail -->
<canvas
	id="cursor-trail-canvas"
	class="cursor-trail-canvas"
	aria-hidden="true"
></canvas>

<div
	id="custom-cursor"
	class:list={['custom-cursor', className]}
	aria-hidden="true"
>
	<div class="custom-cursor__circle"></div>
</div>

<script>
	import { initCustomCursor, cleanupCustomCursor } from "../../scripts/custom-cursor";
	import { initCursorTrail, cleanupCursorTrail } from "../../scripts/cursor-trail";

	// Initialize custom cursor
	initCustomCursor();

	// Initialize cursor trail
	initCursorTrail();

	// Clean up on page navigation
	document.addEventListener("astro:before-swap", () => {
		cleanupCustomCursor();
		cleanupCursorTrail();
	});
</script>

<style>
	/* Canvas for cursor trail */
	.cursor-trail-canvas {
		position: fixed;
		top: 0;
		left: 0;
		width: 100vw;
		height: 100vh;
		z-index: 9999; /* Below cursor but above everything else */
		pointer-events: none;
	}

	/* Hide on touch devices */
	@media (hover: none) or (pointer: coarse) {
		.cursor-trail-canvas {
			display: none;
		}
	}

	.custom-cursor {
		position: fixed;
		top: 0;
		left: 0;
		z-index: 10000;
		pointer-events: none;
		mix-blend-mode: difference;
		will-change: transform;
	}

	.custom-cursor__circle {
		width: 32px;
		height: 32px;
		border: 2px solid var(--color-text);
		border-radius: 50%;
		transform: translate(-50%, -50%);
		transition: width var(--transition-fast),
		            height var(--transition-fast),
		            border-width var(--transition-fast);
	}

	/* Hide default cursor on desktop */
	@media (hover: hover) and (pointer: fine) {
		:global(body) {
			cursor: none;
		}

		:global(a),
		:global(button),
		:global([data-cursor]) {
			cursor: none;
		}
	}

	/* Hide custom cursor on touch devices */
	@media (hover: none) or (pointer: coarse) {
		.custom-cursor {
			display: none;
		}
	}

	/* Hover state (applied via JavaScript) */
	.custom-cursor--hover .custom-cursor__circle {
		width: 64px;
		height: 64px;
		border-width: 3px;
	}

	/* Reduced motion: instant transitions */
	@media (prefers-reduced-motion: reduce) {
		.custom-cursor__circle {
			transition: none;
		}
	}
</style>
