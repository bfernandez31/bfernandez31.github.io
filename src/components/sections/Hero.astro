---
export interface Props {
	headline: string;
	subheadline?: string;
	ctaText?: string;
	ctaLink?: string;
}

const { headline, subheadline, ctaText, ctaLink } = Astro.props;
---

<section
	class="hero"
	id="hero"
	data-section="hero"
	role="main"
	aria-label="Hero section with introduction"
>
	<!-- WebGL Canvas (aria-hidden for accessibility) -->
	<canvas id="hero-canvas" class="hero__canvas" aria-hidden="true"></canvas>

	<!-- Fallback gradient (visible if JS/WebGL fails or before load) -->
	<div class="hero__fallback" aria-hidden="true"></div>

	<!-- Content Layer -->
	<div class="hero__content hero__content--animated">
		<!-- Headline with glitch effect -->
		<h1 class="hero__headline glitch-effect" data-hero-text="headline">
			{headline}
		</h1>
		{
			subheadline && (
				<p class="hero__subheadline" data-hero-text="subheadline">
					{subheadline}
				</p>
			)
		}
		{
			ctaText && ctaLink && (
				<a href={ctaLink} class="hero__cta" data-hero-text="cta">
					{ctaText}
				</a>
			)
		}
	</div>

	<!-- Scroll indicator (appears after scroll progress) -->
	<div class="hero__scroll-indicator" aria-hidden="true">
		<span class="hero__scroll-indicator-text">Scroll</span>
		<span class="hero__scroll-indicator-arrow"></span>
	</div>

	<!-- Noscript fallback -->
	<noscript>
		<style>
			.hero__content--animated {
				opacity: 1 !important;
				transform: none !important;
			}
			.hero__fallback {
				opacity: 1 !important;
			}
		</style>
	</noscript>
</section>

<script>
	import { initHeroAnimation } from "../../scripts/hero/hero-controller";

	// Initialize hero on DOM ready
	document.addEventListener("DOMContentLoaded", async () => {
		const canvas = document.getElementById("hero-canvas") as HTMLCanvasElement;
		const content = document.querySelector(".hero__content") as HTMLElement;

		if (canvas && content) {
			try {
				await initHeroAnimation({
					canvas,
					contentContainer: content,
					onEntranceComplete: () => {
						// Animation complete - could trigger analytics or other events
					},
				});
			} catch (error) {
				// Fallback: show content immediately if initialization fails
				content.style.opacity = "1";
				content.style.transform = "none";
				const textElements = content.querySelectorAll("[data-hero-text]");
				textElements.forEach((el) => {
					(el as HTMLElement).style.opacity = "1";
					(el as HTMLElement).style.transform = "none";
				});
			}
		}
	});

	// Cleanup on page navigation (Astro View Transitions)
	document.addEventListener("astro:before-swap", () => {
		window.__heroController__?.destroy();
	});
</script>

<style>
	.hero {
		position: relative;
		min-height: 100vh;
		min-height: 100dvh;
		display: flex;
		align-items: center;
		justify-content: center;
		overflow: hidden;
		padding: 2rem;
		background: var(--color-background);
		border: none;
		outline: none;
	}

	.hero__canvas {
		position: absolute;
		inset: 0;
		width: 100%;
		height: 100%;
		z-index: 0;
		opacity: 0;
		transition: opacity 0.3s ease-out;
	}

	.hero.hero--active .hero__canvas {
		opacity: 1;
	}

	.hero__fallback {
		position: absolute;
		inset: 0;
		z-index: 0;
		background: linear-gradient(
			135deg,
			var(--color-background) 0%,
			color-mix(in oklch, var(--color-primary), var(--color-background) 85%)
				50%,
			var(--color-background) 100%
		);
		opacity: 1;
		transition: opacity 0.3s ease-out;
	}

	.hero.hero--active .hero__fallback {
		opacity: 0;
		pointer-events: none;
	}

	.hero__content {
		position: relative;
		z-index: 1;
		text-align: center;
		max-width: 800px;
		margin: 0 auto;
	}

	.hero__content--animated {
		opacity: 0;
		transform: translateY(20px);
	}

	.hero__headline {
		font-size: clamp(2.5rem, 6vw, 5rem);
		font-weight: 700;
		color: var(--color-text);
		margin-bottom: clamp(1rem, 2.5vw, 2rem);
		line-height: 1.1;
		text-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
	}

	.hero__subheadline {
		font-size: clamp(1.125rem, 2.5vw, 1.5rem);
		color: var(--color-text);
		opacity: 0.9;
		margin-bottom: clamp(1.5rem, 4vw, 3rem);
		line-height: 1.5;
		text-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
	}

	.hero__cta {
		display: inline-block;
		padding: 1rem 2.5rem;
		font-size: 1.125rem;
		font-weight: 600;
		color: var(--color-background);
		background: var(--color-primary);
		border-radius: 8px;
		text-decoration: none;
		transition:
			background-color 0.3s ease,
			transform 0.3s ease,
			box-shadow 0.3s ease;
		will-change: transform;
		box-shadow: 0 4px 12px rgba(203, 166, 247, 0.3);
	}

	@media (hover: hover) {
		.hero__cta:hover {
			background: var(--color-secondary);
			transform: translateY(-2px);
			box-shadow: 0 6px 16px rgba(245, 194, 231, 0.4);
		}
	}

	.hero__cta:focus-visible {
		outline: 2px solid var(--color-primary);
		outline-offset: 4px;
		box-shadow: 0 0 0 4px rgba(203, 166, 247, 0.3);
	}

	.hero__cta:active {
		transform: translateY(0);
	}

	/* Scroll indicator */
	.hero__scroll-indicator {
		position: absolute;
		bottom: 2rem;
		left: 50%;
		transform: translateX(-50%);
		display: flex;
		flex-direction: column;
		align-items: center;
		gap: 0.5rem;
		opacity: 0;
		transition: opacity 0.5s ease-out;
		pointer-events: none;
		z-index: 2;
	}

	.hero--scrolled .hero__scroll-indicator {
		opacity: 1;
		animation: scroll-bounce 2s ease-in-out infinite;
	}

	.hero__scroll-indicator-text {
		font-size: 0.75rem;
		text-transform: uppercase;
		letter-spacing: 0.15em;
		color: var(--color-text);
		opacity: 0.7;
	}

	.hero__scroll-indicator-arrow {
		width: 1.5rem;
		height: 1.5rem;
		border-right: 2px solid var(--color-primary);
		border-bottom: 2px solid var(--color-primary);
		transform: rotate(45deg);
		opacity: 0.8;
	}

	@keyframes scroll-bounce {
		0%,
		20%,
		50%,
		80%,
		100% {
			transform: translateX(-50%) translateY(0);
		}
		40% {
			transform: translateX(-50%) translateY(10px);
		}
		60% {
			transform: translateX(-50%) translateY(5px);
		}
	}

	/* Accessibility: Reduced motion support */
	@media (prefers-reduced-motion: reduce) {
		.hero__content--animated {
			opacity: 1;
			transform: none;
		}

		.hero__canvas,
		.hero__fallback {
			transition: none;
		}

		.hero__cta {
			transition: background-color 0.15s ease;
		}

		@media (hover: hover) {
			.hero__cta:hover {
				transform: none;
			}
		}

		.hero--scrolled .hero__scroll-indicator {
			animation: none;
		}
	}
</style>
